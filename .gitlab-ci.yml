# CI/CD configuration for VGG Image Search Engine (VISE)
# https://gitlab.com/vgg/vise
# https://www.robots.ox.ac.uk/~vgg/software/vise/
#
# Author: Abhishek Dutta <adutta@robots.ox.ac.uk>
# Date  : 13-June-2021

stages:
  - build
  - test

Windows-10-Build:
  stage: build
  tags:
    - vgg-windows-10-builder
  script:
    - echo "Building VISE for Windows 64 bit"
    - cmd.exe /Q /C "C:\Users\tlm\code\vise\scripts\dist\build-win64.cmd"

Windows-10-Test:
  stage: test
  tags:
    - vgg-windows-10-builder
  script:
    - echo "Testing VISE on Oxford-Buildings-100 subset"
    - C:\Users\tlm\build\vise\release\Win64\tests\Release\test_oxford_buildings oxford-buildings-100 "C:\Users\tlm\tests\vise\relja_retrival\oxford-buildings-100\images" "C:\Users\tlm\tests\vise\relja_retrival\oxford-buildings-100\gt" 0.03 "C:\Users\tlm\build\vise\tests"

Debian-Build-Test:
  stage: build, test
  tags:
    - vgg-Linux-builder
  script:
    - echo "Buildings VISE for Debian Linux ..."
    - git clone https://gitlab.com/vgg/vise.git
    - pwd
    - cd vise && mkdir cmake_build && cd cmake_build && /home/gitlab-runner/dep/vise/bin/cmake -DCMAKE_PREFIX_PATH=/home/gitlab-runner/dep/vise/ ../src && make -j
    - pwd
    - tests/test_oxford_buildings oxford-buildings-100 /home/gitlab-runner/dataset/oxford_buildings/oxford-buildings-100/images/ /home/gitlab-runner/dataset/oxford_buildings/oxford-buildings-100/gt/ 0.03 /tmp/
